<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• - ‡πÄ‡∏ß‡∏ä‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</title>
    <link rel="stylesheet" href="/static/style.css">

</head>
<body>
    <div class="wrapper">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h3>‡∏£‡∏û.‡∏î‡∏≠‡∏Å‡∏Ñ‡∏≥‡πÉ‡∏ï‡πâ</h3> <p>Medical Record System</p>
            </div>
            <ul class="menu">
                <li><a href="/dashboard"><span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</a></li>
                <li><a href="/register"><span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></span> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏´‡∏°‡πà</a></li>
                <li><a href="/patient-list" class="active"><span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg></span> ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</a></li>
                <li><a href="#" onclick="logout()"><span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg></span> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></li>
            </ul>
        </nav>

        <div class="main-content">
            <div class="header-title">
                <span class="header-icon"><svg viewBox="0 0 24 24" style="width:32px; height:32px; fill:#2d6a4f;"><path d="M12 2C6.48 2 2 4.24 2 7v10c0 2.76 4.48 5 10 5s10-2.24 10-5V7c0-2.76-4.48-5-10-5zm0 14c-4.45 0-7.23-1.61-7.79-3.09.91.49 2.22.88 3.79 1.09 1.15.15 2.5.23 4 .23s2.85-.08 4-.23c1.57-.21 2.88-.6 3.79-1.09C19.23 16.39 16.45 18 12 18zm0-4c-4.45 0-7.23-1.61-7.79-3.09.91.49 2.22.88 3.79 1.09 1.15.15 2.5.23 4 .23s2.85-.08 4-.23c1.57-.21 2.88-.6 3.79-1.09C19.23 12.39 16.45 14 12 14zm0-4C7.55 10 4.77 8.39 4.21 6.91c.91.49 2.22.88 3.79 1.09 1.15.15 2.5.23 4 .23s2.85-.08 4-.23c1.57-.21 2.88-.6 3.79-1.09C19.23 8.39 16.45 10 12 10z"/></svg></span>
                ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏ä‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢
            </div>

            <div class="search-container">
                <form method="GET" action="/patient-list">
                    <div class="search-box">
                        <span class="search-icon">
                            <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.516 5.91 13.09 3 9.5 3S3 5.91 3 9.55.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5z"/></svg>
                        </span>

                        <input
                            type="text"
                            name="search"
                            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£..."
                            value="<%= search %>">
                    </div>
                </form>
            </div>

            <div style="margin-top: 20px;">
                <table>
                    <thead>
                        <tr><th>‡∏Ñ‡∏¥‡∏ß</th> <th>HN</th> <th>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th> <th>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>  <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
                    </thead>
                    <tbody>
                        <% patients.forEach((p, i) => { %>
                            <tr>
                                <td><%= i + 1 %></td>
                                <td><%= p.HN %></td>
                                <td><%= p.cid %></td>
                                <td><%= p.firstname %> <%= p.lastname %></td>
                                
                                <td>
                                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î modal -->
                                    <a href="#viewModal-<%= p.HN %>" class="btn-view">‡∏î‡∏π</a>
                                    <a href="#editModal-<%= p.HN %>" class="btn-edit">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                                    <form action="/patient/delete" method="POST"
                                    style="display:inline"
                                        onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢\n<%= p.firstname %> <%= p.lastname %>\n(HN: <%= p.HN %>) ?')">

                                        <input type="hidden" name="HN" value="<%= p.HN %>">

                                        <button type="submit" class="btn-view btn-del">
                                            ‡∏•‡∏ö
                                        </button>
                                    </form>
                                </td>
                                
                            </tr>
                        <% }) %>
                        </tbody>
                </table>
            </div>
        </div>
    </div>
    <% patients.forEach(p => { %>
    <div id="viewModal-<%= p.HN %>" class="modal">
        <div class="modal-content" style="max-width:900px;">
            <div class="modal-header">
                <h3>üìÑ ‡πÅ‡∏ü‡πâ‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (OPD Card)</h3>
                <a href="#" class="close">√ó</a>
            </div>

            <div class="modal-body">
                <div class="detail-grid">

                    <div class="section-head">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
                    <div class="detail-item"><strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•:</strong> <%= p.firstname %> <%= p.lastname %></div>
                    <div class="detail-item"><strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£:</strong> <%= p.cid %></div>
                    <div class="detail-item"><strong>‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î:</strong> <%= p.blood %></div>
                    <div class="detail-item"><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> <%= p.phone %></div>
                    <div class="detail-item"><strong>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</strong> <%= p.career %></div>

                    <div class="section-head">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</div>
                    <div style="grid-column: span 2;">
                        <%= p.s_dis %> <%= p.dis %> <%= p.province %>
                    </div>

                    <div class="section-head">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</div>
                    <div class="detail-item"><strong>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥:</strong> <%= p.insurance %></div>
                    <div class="detail-item"><strong>‡πÄ‡∏•‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥:</strong> <%= p.insurance_id %></div>
                </div>

                <hr>

                <h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</h4>

                <% if (p.visits && p.visits.length) { %>
                    <table width="100%" border="1">
                        <thead>
                            <tr>
                                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</th>
                                <th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</th>
                                <th>‡πÅ‡∏û‡∏ó‡∏¢‡πå</th>
                                <th>‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% p.visits.forEach(v => { %>
                            <tr>
                                <td>
                                    <%= v.date
                                        ? new Date(v.date).toLocaleDateString('th-TH')
                                        : "-" %>
                                </td>
                                <td><%= v.hospital || "-" %></td>
                                <td><%= v.symptoms || "-" %></td>
                                <td><%= v.doctor || "-" %></td>
                                <td><%= v.diagnosis || "-" %></td>
                            </tr>
                            <% }) %>
                        </tbody>
                    </table>
                <% } else { %>
                    <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</p>
                <% } %>
                    </div>
            </div>
        </div>
        <% }) %>
    </div>

<% patients.forEach(p => { %>
<div id="editModal-<%= p.HN %>" class="modal">
    <div class="modal-content" style="max-width:900px;">
        <div class="modal-header">
            <h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (HN: <%= p.HN %>)</h3>
            <a href="#" class="close">√ó</a>
        </div>

        <div class="modal-body">

            <form action="/patient/update" method="POST">

                <input type="hidden" name="HN" value="<%= p.HN %>">

                <div class="detail-grid">

                    <div class="section-head">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>

                    <div class="detail-item">
                        <strong>‡∏ä‡∏∑‡πà‡∏≠:</strong>
                        <input class="modal-input" type="text" name="firstname" value="<%= p.firstname %>">
                    </div>

                    <div class="detail-item">
                        <strong>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</strong>
                        <input class="modal-input" type="text" name="lastname" value="<%= p.lastname %>">
                    </div>

                    <div class="detail-item">
                        <strong>‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£:</strong>
                        <input class="modal-input" type="text" name="cid" value="<%= p.cid %>">
                    </div>

                    <div class="detail-item">
                        <strong>‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î:</strong>
                        <input class="modal-input" type="text" name="blood" value="<%= p.blood %>">
                    </div>

                    <div class="detail-item">
                        <strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong>
                        <input class="modal-input" type="text" name="phone" value="<%= p.phone %>">
                    </div>

                    <div class="detail-item">
                        <strong>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</strong>
                        <input class="modal-input" type="text" name="career" value="<%= p.career %>">
                    </div>

                    <div class="section-head">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</div>

                    <div style="grid-column: span 2;">
                        <input class="modal-input" type="text" name="s_dis" value="<%= p.s_dis %>">
                        <input class="modal-input" type="text" name="dis" value="<%= p.dis %>">
                        <input class="modal-input" type="text" name="province" value="<%= p.province %>">
                    </div>

                    <div class="section-head">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</div>

                    <div class="detail-item">
                        <strong>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥:</strong>
                        <input class="modal-input" type="text" name="insurance" value="<%= p.insurance %>">
                    </div>

                    <div class="detail-item">
                        <strong>‡πÄ‡∏•‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥:</strong>
                        <input class="modal-input" type="text" name="insurance_id" value="<%= p.insurance_id %>">
                    </div>

                </div>

                <button type="submit" class="btn-submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>

            </form>

        </div>
    </div>
</div>
<% }) %>



    <script src="/static/script.js"></script>
</body>
</html>